# PenguinMagic Electron æ‰“åŒ…ä½¿ç”¨è¯´æ˜

## å·²å®Œæˆçš„å·¥ä½œ

âœ… å®‰è£… Electron ç›¸å…³ä¾èµ–
âœ… åˆ›å»º Electron ä¸»è¿›ç¨‹ï¼ˆelectron/main.cjsï¼‰
âœ… åˆ›å»ºé¢„åŠ è½½è„šæœ¬ï¼ˆelectron/preload.cjsï¼‰
âœ… é…ç½®åç«¯æ”¯æŒ Electron ç¯å¢ƒ
âœ… é…ç½® Vite æ„å»º
âœ… æ›´æ–° package.json è„šæœ¬å’Œé…ç½®
âœ… åˆ›å»ºåº”ç”¨å›¾æ ‡
âœ… æµ‹è¯•å¼€å‘æ¨¡å¼ - æˆåŠŸè¿è¡Œ
âœ… å‰ç«¯æ„å»º - æˆåŠŸ

## å¼€å‘æ¨¡å¼

å¯åŠ¨å¼€å‘æ¨¡å¼ï¼ˆåŒ…å«çƒ­é‡è½½ï¼‰ï¼š

```bash
npm run electron:dev
```

è¿™å°†åŒæ—¶å¯åŠ¨ï¼š
1. åç«¯æœåŠ¡ï¼ˆç«¯å£ 8765ï¼‰
2. Vite å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 5176ï¼‰
3. Electron çª—å£

## ç”Ÿäº§æ„å»º

### ä»…æ„å»ºå‰ç«¯
```bash
npm run build
```

### æ‰“åŒ… Windows åº”ç”¨
```bash
npm run package
```

è¿™å°†ï¼š
1. æ„å»ºå‰ç«¯ï¼ˆç”Ÿæˆ dist/ï¼‰
2. ä½¿ç”¨ electron-builder æ‰“åŒ…
3. è¾“å‡ºåˆ° release/ ç›®å½•

### æ‰“åŒ…æ‰€æœ‰å¹³å°
```bash
npm run package:all
```

æ”¯æŒçš„æ‰“åŒ…æ ¼å¼ï¼š
- **Windows**: NSIS å®‰è£…åŒ…ã€ä¾¿æºç‰ˆ
- **macOS**: DMGã€ZIP
- **Linux**: AppImageã€DEB

## é¡¹ç›®ç»“æ„

```
PenguinMagic/
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.cjs          # Electron ä¸»è¿›ç¨‹
â”‚   â””â”€â”€ preload.cjs       # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ backend-nodejs/       # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ server.js     # Express æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ config.js     # é…ç½®ï¼ˆæ”¯æŒ Electron ç¯å¢ƒï¼‰
â”‚   â”‚   â””â”€â”€ routes/       # API è·¯ç”±
â”‚   â””â”€â”€ node_modules/     # åç«¯ä¾èµ–ï¼ˆä¼šæ‰“åŒ…è¿›åº”ç”¨ï¼‰
â”œâ”€â”€ resources/            # åº”ç”¨èµ„æº
â”‚   â”œâ”€â”€ icon.svg          # SVG å›¾æ ‡
â”‚   â”œâ”€â”€ icon.png          # PNG å›¾æ ‡
â”‚   â””â”€â”€ README.md         # å›¾æ ‡ç”Ÿæˆè¯´æ˜
â”œâ”€â”€ dist/                 # å‰ç«¯æ„å»ºäº§ç‰©
â”œâ”€â”€ release/              # æ‰“åŒ…è¾“å‡ºç›®å½•
â””â”€â”€ package.json          # é¡¹ç›®é…ç½®
```

## ç¯å¢ƒå˜é‡

### å¼€å‘ç¯å¢ƒ
- `NODE_ENV=development`
- ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä½œä¸ºæ•°æ®ç›®å½•

### ç”Ÿäº§ç¯å¢ƒï¼ˆElectronï¼‰
- `NODE_ENV=production`
- `IS_ELECTRON=true`
- `USER_DATA_PATH`: ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆç”± Electron æä¾›ï¼‰
- æ•°æ®å­˜å‚¨åœ¨ï¼š`%APPDATA%/penguin-magic` (Windows)

## è·¯å¾„å¤„ç†

### å¼€å‘æ¨¡å¼
- åŸºç¡€ç›®å½•ï¼šé¡¹ç›®æ ¹ç›®å½•
- å‰ç«¯ï¼šhttp://localhost:5176
- åç«¯ï¼šhttp://localhost:8765

### ç”Ÿäº§æ¨¡å¼ï¼ˆElectronï¼‰
- åŸºç¡€ç›®å½•ï¼šç”¨æˆ·æ•°æ®ç›®å½•
- å‰ç«¯ï¼šä» dist/ åŠ è½½ï¼ˆç”±åç«¯æœåŠ¡ï¼‰
- åç«¯ï¼šå†…åµŒåœ¨åº”ç”¨ä¸­ï¼Œè‡ªåŠ¨å¯åŠ¨

## åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°
- âœ… çª—å£ç®¡ç†ï¼ˆåˆ›å»ºã€å…³é—­ã€ç”Ÿå‘½å‘¨æœŸï¼‰
- âœ… åç«¯æœåŠ¡è‡ªåŠ¨å¯åŠ¨å’Œåœæ­¢
- âœ… åŸç”Ÿèœå•æ ï¼ˆæ–‡ä»¶ã€ç¼–è¾‘ã€è§†å›¾ã€å¸®åŠ©ï¼‰
- âœ… å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
- âœ… ä¸Šä¸‹æ–‡éš”ç¦»å’Œå®‰å…¨é…ç½®
- âœ… è·¨å¹³å°è·¯å¾„å¤„ç†
- âœ… å›¾æ ‡èµ„æºç®¡ç†

### å¯æ‰©å±•åŠŸèƒ½
- ğŸ”² è‡ªåŠ¨æ›´æ–°ï¼ˆelectron-updaterï¼‰
- ğŸ”² æ‰˜ç›˜å›¾æ ‡å’Œèœå•
- ğŸ”² å…¨å±€å¿«æ·é”®
- ğŸ”² æ–‡ä»¶æ‹–æ‹½
- ğŸ”² åŸç”Ÿå¯¹è¯æ¡†
- ğŸ”² ç³»ç»Ÿé€šçŸ¥

## é…ç½®è¯´æ˜

### electron/main.cjs
ä¸»è¿›ç¨‹é…ç½®å‚æ•°ï¼š
- `windowWidth`: 1280ï¼ˆçª—å£å®½åº¦ï¼‰
- `windowHeight`: 800ï¼ˆçª—å£é«˜åº¦ï¼‰
- `minWidth`: 1024ï¼ˆæœ€å°å®½åº¦ï¼‰
- `minHeight`: 768ï¼ˆæœ€å°é«˜åº¦ï¼‰
- `backendPort`: 8765ï¼ˆåç«¯ç«¯å£ï¼‰

### package.json - build é…ç½®
```json
{
  "appId": "com.penguin.magic",
  "productName": "PenguinMagic",
  "directories": {
    "output": "release"
  },
  "files": [
    "dist/**/*",
    "electron/**/*",
    "backend-nodejs/**/*",
    "!backend-nodejs/node_modules/**/*",
    "package.json"
  ],
  "extraResources": [
    {
      "from": "backend-nodejs/node_modules",
      "to": "backend-nodejs/node_modules"
    }
  ]
}
```

## æ•…éšœæ’é™¤

### ç«¯å£è¢«å ç”¨
```bash
# Windows
netstat -ano | findstr :8765
taskkill /F /PID [PID]

# æˆ–åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹
taskkill /F /IM node.exe
```

### Electron æ— æ³•å¯åŠ¨
1. æ£€æŸ¥æ˜¯å¦æ­£ç¡®å®‰è£… electron
   ```bash
   npx electron --version
   ```

2. æ¸…ç†ç¼“å­˜é‡æ–°å®‰è£…
   ```bash
   rm -rf node_modules
   npm install
   ```

### æ‰“åŒ…å¤±è´¥
1. ç¡®ä¿å‰ç«¯å·²æ„å»º
   ```bash
   npm run build
   ```

2. æ£€æŸ¥ Sharp ä¾èµ–
   ```bash
   cd backend-nodejs
   npm rebuild sharp
   ```

3. ä½¿ç”¨æ·˜å®é•œåƒåŠ é€Ÿ
   - å·²é…ç½® .npmrc ä½¿ç”¨å›½å†…é•œåƒ

### å›¾æ ‡é—®é¢˜
- å½“å‰ä½¿ç”¨ PNG æ ¼å¼å›¾æ ‡
- æŸ¥çœ‹ resources/README.md äº†è§£å¦‚ä½•ç”Ÿæˆå…¶ä»–æ ¼å¼

## æµ‹è¯•æ¸…å•

- [x] å¼€å‘æ¨¡å¼å¯åŠ¨
- [x] å‰ç«¯æ„å»ºæˆåŠŸ
- [x] API è¯·æ±‚æ­£å¸¸
- [x] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- [x] å›¾åƒå¤„ç†åŠŸèƒ½
- [x] èœå•åŠŸèƒ½
- [ ] Windows æ‰“åŒ…æµ‹è¯•
- [ ] å®‰è£…åŒ…æµ‹è¯•
- [ ] ä¾¿æºç‰ˆæµ‹è¯•

## åç»­å·¥ä½œ

1. **å›¾æ ‡ä¼˜åŒ–**ï¼šç”Ÿæˆ .ico å’Œ .icns æ ¼å¼
2. **æ‰“åŒ…æµ‹è¯•**ï¼šåœ¨ä¸åŒå¹³å°æµ‹è¯•å®‰è£…åŒ…
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°æ‰“åŒ…ä½“ç§¯
4. **åŠŸèƒ½å¢å¼º**ï¼šæ·»åŠ æ‰˜ç›˜ã€è‡ªåŠ¨æ›´æ–°ç­‰
5. **æ–‡æ¡£å®Œå–„**ï¼šç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ

## ç›¸å…³èµ„æº

- [Electron æ–‡æ¡£](https://www.electronjs.org/docs/latest/)
- [Electron Builder æ–‡æ¡£](https://www.electron.build/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
2. æ£€æŸ¥ DevTools (F12)
3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼ˆåå°æœåŠ¡è¾“å‡ºï¼‰
4. å‚è€ƒè®¾è®¡æ–‡æ¡£ï¼š.qoder/quests/electron-packaging.md
# PenguinMagic Electron æ‰“åŒ…ä½¿ç”¨è¯´æ˜

## å·²å®Œæˆçš„å·¥ä½œ

âœ… å®‰è£… Electron ç›¸å…³ä¾èµ–
âœ… åˆ›å»º Electron ä¸»è¿›ç¨‹ï¼ˆelectron/main.cjsï¼‰
âœ… åˆ›å»ºé¢„åŠ è½½è„šæœ¬ï¼ˆelectron/preload.cjsï¼‰
âœ… é…ç½®åç«¯æ”¯æŒ Electron ç¯å¢ƒ
âœ… é…ç½® Vite æ„å»º
âœ… æ›´æ–° package.json è„šæœ¬å’Œé…ç½®
âœ… åˆ›å»ºåº”ç”¨å›¾æ ‡
âœ… æµ‹è¯•å¼€å‘æ¨¡å¼ - æˆåŠŸè¿è¡Œ
âœ… å‰ç«¯æ„å»º - æˆåŠŸ

## å¼€å‘æ¨¡å¼

å¯åŠ¨å¼€å‘æ¨¡å¼ï¼ˆåŒ…å«çƒ­é‡è½½ï¼‰ï¼š

```bash
npm run electron:dev
```

è¿™å°†åŒæ—¶å¯åŠ¨ï¼š
1. åç«¯æœåŠ¡ï¼ˆç«¯å£ 8765ï¼‰
2. Vite å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 5176ï¼‰
3. Electron çª—å£

## ç”Ÿäº§æ„å»º

### ä»…æ„å»ºå‰ç«¯
```bash
npm run build
```

### æ‰“åŒ… Windows åº”ç”¨
```bash
npm run package
```

è¿™å°†ï¼š
1. æ„å»ºå‰ç«¯ï¼ˆç”Ÿæˆ dist/ï¼‰
2. ä½¿ç”¨ electron-builder æ‰“åŒ…
3. è¾“å‡ºåˆ° release/ ç›®å½•

### æ‰“åŒ…æ‰€æœ‰å¹³å°
```bash
npm run package:all
```

æ”¯æŒçš„æ‰“åŒ…æ ¼å¼ï¼š
- **Windows**: NSIS å®‰è£…åŒ…ã€ä¾¿æºç‰ˆ
- **macOS**: DMGã€ZIP
- **Linux**: AppImageã€DEB

## é¡¹ç›®ç»“æ„

```
PenguinMagic/
â”œâ”€â”€ electron/
â”‚   â”œâ”€â”€ main.cjs          # Electron ä¸»è¿›ç¨‹
â”‚   â””â”€â”€ preload.cjs       # é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ backend-nodejs/       # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ server.js     # Express æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ config.js     # é…ç½®ï¼ˆæ”¯æŒ Electron ç¯å¢ƒï¼‰
â”‚   â”‚   â””â”€â”€ routes/       # API è·¯ç”±
â”‚   â””â”€â”€ node_modules/     # åç«¯ä¾èµ–ï¼ˆä¼šæ‰“åŒ…è¿›åº”ç”¨ï¼‰
â”œâ”€â”€ resources/            # åº”ç”¨èµ„æº
â”‚   â”œâ”€â”€ icon.svg          # SVG å›¾æ ‡
â”‚   â”œâ”€â”€ icon.png          # PNG å›¾æ ‡
â”‚   â””â”€â”€ README.md         # å›¾æ ‡ç”Ÿæˆè¯´æ˜
â”œâ”€â”€ dist/                 # å‰ç«¯æ„å»ºäº§ç‰©
â”œâ”€â”€ release/              # æ‰“åŒ…è¾“å‡ºç›®å½•
â””â”€â”€ package.json          # é¡¹ç›®é…ç½®
```

## ç¯å¢ƒå˜é‡

### å¼€å‘ç¯å¢ƒ
- `NODE_ENV=development`
- ä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•ä½œä¸ºæ•°æ®ç›®å½•

### ç”Ÿäº§ç¯å¢ƒï¼ˆElectronï¼‰
- `NODE_ENV=production`
- `IS_ELECTRON=true`
- `USER_DATA_PATH`: ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆç”± Electron æä¾›ï¼‰
- æ•°æ®å­˜å‚¨åœ¨ï¼š`%APPDATA%/penguin-magic` (Windows)

## è·¯å¾„å¤„ç†

### å¼€å‘æ¨¡å¼
- åŸºç¡€ç›®å½•ï¼šé¡¹ç›®æ ¹ç›®å½•
- å‰ç«¯ï¼šhttp://localhost:5176
- åç«¯ï¼šhttp://localhost:8765

### ç”Ÿäº§æ¨¡å¼ï¼ˆElectronï¼‰
- åŸºç¡€ç›®å½•ï¼šç”¨æˆ·æ•°æ®ç›®å½•
- å‰ç«¯ï¼šä» dist/ åŠ è½½ï¼ˆç”±åç«¯æœåŠ¡ï¼‰
- åç«¯ï¼šå†…åµŒåœ¨åº”ç”¨ä¸­ï¼Œè‡ªåŠ¨å¯åŠ¨

## åŠŸèƒ½ç‰¹æ€§

### å·²å®ç°
- âœ… çª—å£ç®¡ç†ï¼ˆåˆ›å»ºã€å…³é—­ã€ç”Ÿå‘½å‘¨æœŸï¼‰
- âœ… åç«¯æœåŠ¡è‡ªåŠ¨å¯åŠ¨å’Œåœæ­¢
- âœ… åŸç”Ÿèœå•æ ï¼ˆæ–‡ä»¶ã€ç¼–è¾‘ã€è§†å›¾ã€å¸®åŠ©ï¼‰
- âœ… å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
- âœ… ä¸Šä¸‹æ–‡éš”ç¦»å’Œå®‰å…¨é…ç½®
- âœ… è·¨å¹³å°è·¯å¾„å¤„ç†
- âœ… å›¾æ ‡èµ„æºç®¡ç†

### å¯æ‰©å±•åŠŸèƒ½
- ğŸ”² è‡ªåŠ¨æ›´æ–°ï¼ˆelectron-updaterï¼‰
- ğŸ”² æ‰˜ç›˜å›¾æ ‡å’Œèœå•
- ğŸ”² å…¨å±€å¿«æ·é”®
- ğŸ”² æ–‡ä»¶æ‹–æ‹½
- ğŸ”² åŸç”Ÿå¯¹è¯æ¡†
- ğŸ”² ç³»ç»Ÿé€šçŸ¥

## é…ç½®è¯´æ˜

### electron/main.cjs
ä¸»è¿›ç¨‹é…ç½®å‚æ•°ï¼š
- `windowWidth`: 1280ï¼ˆçª—å£å®½åº¦ï¼‰
- `windowHeight`: 800ï¼ˆçª—å£é«˜åº¦ï¼‰
- `minWidth`: 1024ï¼ˆæœ€å°å®½åº¦ï¼‰
- `minHeight`: 768ï¼ˆæœ€å°é«˜åº¦ï¼‰
- `backendPort`: 8765ï¼ˆåç«¯ç«¯å£ï¼‰

### package.json - build é…ç½®
```json
{
  "appId": "com.penguin.magic",
  "productName": "PenguinMagic",
  "directories": {
    "output": "release"
  },
  "files": [
    "dist/**/*",
    "electron/**/*",
    "backend-nodejs/**/*",
    "!backend-nodejs/node_modules/**/*",
    "package.json"
  ],
  "extraResources": [
    {
      "from": "backend-nodejs/node_modules",
      "to": "backend-nodejs/node_modules"
    }
  ]
}
```

## æ•…éšœæ’é™¤

### ç«¯å£è¢«å ç”¨
```bash
# Windows
netstat -ano | findstr :8765
taskkill /F /PID [PID]

# æˆ–åœæ­¢æ‰€æœ‰ Node è¿›ç¨‹
taskkill /F /IM node.exe
```

### Electron æ— æ³•å¯åŠ¨
1. æ£€æŸ¥æ˜¯å¦æ­£ç¡®å®‰è£… electron
   ```bash
   npx electron --version
   ```

2. æ¸…ç†ç¼“å­˜é‡æ–°å®‰è£…
   ```bash
   rm -rf node_modules
   npm install
   ```

### æ‰“åŒ…å¤±è´¥
1. ç¡®ä¿å‰ç«¯å·²æ„å»º
   ```bash
   npm run build
   ```

2. æ£€æŸ¥ Sharp ä¾èµ–
   ```bash
   cd backend-nodejs
   npm rebuild sharp
   ```

3. ä½¿ç”¨æ·˜å®é•œåƒåŠ é€Ÿ
   - å·²é…ç½® .npmrc ä½¿ç”¨å›½å†…é•œåƒ

### å›¾æ ‡é—®é¢˜
- å½“å‰ä½¿ç”¨ PNG æ ¼å¼å›¾æ ‡
- æŸ¥çœ‹ resources/README.md äº†è§£å¦‚ä½•ç”Ÿæˆå…¶ä»–æ ¼å¼

## æµ‹è¯•æ¸…å•

- [x] å¼€å‘æ¨¡å¼å¯åŠ¨
- [x] å‰ç«¯æ„å»ºæˆåŠŸ
- [x] API è¯·æ±‚æ­£å¸¸
- [x] æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½
- [x] å›¾åƒå¤„ç†åŠŸèƒ½
- [x] èœå•åŠŸèƒ½
- [ ] Windows æ‰“åŒ…æµ‹è¯•
- [ ] å®‰è£…åŒ…æµ‹è¯•
- [ ] ä¾¿æºç‰ˆæµ‹è¯•

## åç»­å·¥ä½œ

1. **å›¾æ ‡ä¼˜åŒ–**ï¼šç”Ÿæˆ .ico å’Œ .icns æ ¼å¼
2. **æ‰“åŒ…æµ‹è¯•**ï¼šåœ¨ä¸åŒå¹³å°æµ‹è¯•å®‰è£…åŒ…
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°æ‰“åŒ…ä½“ç§¯
4. **åŠŸèƒ½å¢å¼º**ï¼šæ·»åŠ æ‰˜ç›˜ã€è‡ªåŠ¨æ›´æ–°ç­‰
5. **æ–‡æ¡£å®Œå–„**ï¼šç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ

## ç›¸å…³èµ„æº

- [Electron æ–‡æ¡£](https://www.electronjs.org/docs/latest/)
- [Electron Builder æ–‡æ¡£](https://www.electron.build/)
- [Vite æ–‡æ¡£](https://vitejs.dev/)

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
2. æ£€æŸ¥ DevTools (F12)
3. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼ˆåå°æœåŠ¡è¾“å‡ºï¼‰
4. å‚è€ƒè®¾è®¡æ–‡æ¡£ï¼š.qoder/quests/electron-packaging.md
